<!DOCTYPE html><html lang="en-au"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>The Foam Boat That (Almost) Could - Fletcher Walmsley</title><meta name="description" content="blog post about making the HMNZS Otorohanga Autonomous "><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://fletcherpwalmsley.github.io/the-foam-boat-that-almost-could/"><link rel="amphtml" href="https://fletcherpwalmsley.github.io/amp/the-foam-boat-that-almost-could/"><link rel="alternate" type="application/atom+xml" href="https://fletcherpwalmsley.github.io/feed.xml"><link rel="alternate" type="application/json" href="https://fletcherpwalmsley.github.io/feed.json"><meta property="og:title" content="The Foam Boat That (Almost) Could"><meta property="og:site_name" content="Fletcher Walmsley"><meta property="og:description" content="blog post about making the HMNZS Otorohanga Autonomous "><meta property="og:url" content="https://fletcherpwalmsley.github.io/the-foam-boat-that-almost-could/"><meta property="og:type" content="article"><link rel="shortcut icon" href="https://fletcherpwalmsley.github.io/media/website/favicon.ico" type="image/x-icon"><style>:root{--body-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--heading-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--logo-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--menu-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol"}</style><link rel="stylesheet" href="https://fletcherpwalmsley.github.io/assets/css/style.css?v=7903ba6ed68760abccd6ea1196c5075f"><link rel="stylesheet" href="https://fletcherpwalmsley.github.io/assets/css/photoswipe.css?v=7331f6eb15671b2fc8e3ffd46e849f7b"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://fletcherpwalmsley.github.io/the-foam-boat-that-almost-could/"},"headline":"The Foam Boat That (Almost) Could","datePublished":"2021-05-04T22:10","dateModified":"2021-06-02T19:11","description":"blog post about making the HMNZS Otorohanga Autonomous ","author":{"@type":"Person","name":"Fletcher Walmsley"},"publisher":{"@type":"Organization","name":"Fletcher Walmsley"}}</script><style>.pswp--svg .pswp__button,
				          .pswp--svg .pswp__button--arrow--left:before,
				          .pswp--svg .pswp__button--arrow--right:before {
					          background-image: url(https://fletcherpwalmsley.github.io/assets/svg/gallery-icons-light.svg);
			              }</style><script async src="https://www.googletagmanager.com/gtag/js?id=UA-49735686-2"></script><script>window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-49735686-2');</script></head><body><div class="site-container"><header class="top" id="js-header"><a class="logo" href="https://fletcherpwalmsley.github.io/">Fletcher Walmsley</a><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu" aria-haspopup="true" aria-expanded="false"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li><a href="https://fletcherpwalmsley.github.io/about-me-2/" target="_self">About Me</a></li></ul></nav></header><main><article class="post"><div class="hero"><header class="hero__content"><div class="wrapper"><div class="post__meta"><time datetime="2021-05-04T22:10">4 May 2021</time></div><h1>The Foam Boat That (Almost) Could</h1><div class="post__meta post__meta--author"><img src="https://fletcherpwalmsley.github.io/media/website/28468537_2075160929166868_998402505580740608_o.png" loading="eager" alt="Fletcher Walmsley" class="post__author-thumb"> <a href="https://fletcherpwalmsley.github.io/authors/fletcher-walmsley/" class="feed__author invert">Fletcher Walmsley</a></div></div></header></div><div class="wrapper post__entry"><p>Hello, if you're reading this post after looking at the last one, you might have noticed that this second post has been created almost eleven months later!</p><p>There is a reason for such delay is pretty simple, I have not gotten the boat to the state I have wanted before making another post. The first post was all about the creation an manual driving of the vessel. It documented the build of the hull, an overview of the electrical parts, and the mobile software used to remotely control it. This is to say, I achieved all the goals I had set. After making that post I set what seemed like a reasonable next step, to make it autonomous. In this regard I succeeded as can be seen in the video below</p><figure class="post__video"><iframe loading="lazy" width="560" height="314" src="https://www.youtube.com/embed/sgallTuI2Vk" allowfullscreen="allowfullscreen" data-mce-fragment="1"></iframe></figure><p>The above video shows the boat accurately following a small path along the shoreline of Lake Arapuni. This however is the most successful sail the boat has taken to date. I'll discuss the reasons for this at the end. But first, the major progress that has been made. </p><p>A lot has changed since the last post, as such, the best way to show the change is with photos. Figure 1A shows the old electrical set-up, with Figure 1B showing the current one. Note, Figure 1B does not show the GPS or 9 axis IMU that was also installed </p><div class="gallery-wrapper gallery-wrapper--full"><div class="gallery" data-is-empty="false" data-columns="2"><figure class="gallery__item"><a href="https://fletcherpwalmsley.github.io/media/posts/9/gallery/20200415_180253.jpg" data-size="4032x3024"><img loading="lazy" src="https://fletcherpwalmsley.github.io/media/posts/9/gallery/20200415_180253-thumbnail.jpg" alt="" width="720" height="540"></a><figcaption>Figure 1A: Electrical hardware, as found in last post (the power bank to power the rudder servo is absent in this image)</figcaption></figure><figure class="gallery__item"><a href="https://fletcherpwalmsley.github.io/media/posts/9/gallery/v1hull_all_elect.jpg" data-size="1705x959"><img loading="lazy" src="https://fletcherpwalmsley.github.io/media/posts/9/gallery/v1hull_all_elect-thumbnail.jpg" alt="" width="720" height="405"></a><figcaption>Figure 1B: Electrical hardware as it currently stands</figcaption></figure></div></div><p>First major change was the adjustable buck converter arrived, which took the place of the mobile power pack and allowed the rudder servo to be powered by the main battery. </p><p>Another major change was the design decision to switch from using two Arduino Nanos to one ESP32. This was partly due to the second Nano never arriving, but also due to the ESP32 having vastly more processing power than the Nanos combined, which would enable all functions to be run on on MCU, greatly simplifying the design as communications between MCUs was no longer needed. </p><p>The new ESP32 had a perf-board with an integrated reverse polarity diode and a linear voltage regulator (LVR) which steps the battery voltage down to 5v. This voltage regulator is not strictly necessary as the ESP32's onboard linear voltage regulator can handle the maximum voltage of the Li-Po battery (12.6V) and step it down to the required 3.3V, but it gets very hot doing so. This problem is exacerbated in this use case as the ESP32's regulator is being used to power relatively hungry external components like the GPS and IMU unit. Thus with the external voltage regulator, the ESP32's only has to regulate the voltage from 5V to 3.3V, instead of 12.6V. Which makes a large difference to the internal regulators temperature, as linear voltage regulators reduced voltage by discarding the extra potential as heat. (which is governed by the equation P= (Vin - Vout) * ILoad). The efficiency of the boat could be increased by changing to a switching regulator, which seeing as the the ESP32 and all its connected devices commonly draws over 0.5A, could reduce the boats power draw by around 4 watts, a not insignificant amount on a ~57 watt hour battery. An image of the created board can be seen in Figure 2.</p><figure class="post__image post__image--center"><img loading="lazy" src="https://fletcherpwalmsley.github.io/media/posts/9/esp2board-4.jpg" sizes="(max-width: 48em) 100vw, 768px" srcset="https://fletcherpwalmsley.github.io/media/posts/9/responsive/esp2board-4-xs.jpg 300w, https://fletcherpwalmsley.github.io/media/posts/9/responsive/esp2board-4-sm.jpg 480w, https://fletcherpwalmsley.github.io/media/posts/9/responsive/esp2board-4-md.jpg 768w, https://fletcherpwalmsley.github.io/media/posts/9/responsive/esp2board-4-lg.jpg 1024w, https://fletcherpwalmsley.github.io/media/posts/9/responsive/esp2board-4-xl.jpg 1360w, https://fletcherpwalmsley.github.io/media/posts/9/responsive/esp2board-4-2xl.jpg 1600w" alt="" width="266" height="316"><figcaption>Figure 2: ESP32 on it's perf board with external voltage regulator and reverse polarity diode shown </figcaption></figure><p>Another change was the addition of an SD reader, this has been used as an easy way to transfer maps to the boat. Although not currently implemented, it will later also be used to save voyage data.  </p><p>The final major change was the switch from using a Honeywell HMC5883L (or more specifically the Chinese licenced version, the QMC5883L) magnetometer to the Bosch made BNO055 9-axis IMU. This change enabled the used of a more modern sensor, with onboard sensor fusion to enable easy implementation of a tilt compensated compass. But the main reason was an attempt to fix the major problem alluded at the beginning, a problem I have dubbed "IMU dropout".</p><p>The IMU dropout issue, although not really taken much notice of back then, first showed itself in this project back when I was testing the magnetometer on the servo (video can be seen in the last post) in which the magnetometer would randomly stop sending data and all zeros would be the only thing the MCU could read. Fast forward to the first implementation of the automated control system, an image of which can be seen in Figure 3.</p><div class="gallery-wrapper"><div class="gallery" data-is-empty="false" data-columns="1"><figure class="gallery__item"><a href="https://fletcherpwalmsley.github.io/media/posts/9/gallery/first_auto_photo-3.jpg" data-size="1705x959"><img loading="lazy" src="https://fletcherpwalmsley.github.io/media/posts/9/gallery/first_auto_photo-3-thumbnail.jpg" alt="" width="720" height="405"></a><figcaption>Figure 3: First Assembly of the automated system</figcaption></figure></div></div><p>Again the IMU dropout problem occurred, as soon as the motors were enabled, the Honeywell senor would stop working. Eventually I found that if I disabled PWM on the motors and thus have no speed control, the sensor would operate reasonably well. Deducing from this that either the PWM and I2C library were conflicting, or what I believed was the more likely issue, that the rapid switching of the motor, created a large amount of electromagnetic noise. As I wanted to get a better sensor with integrated gyro and accelerometers, the first major set I took to fixing this problem was to buy the Bosch sensor, which I hoped would be less susceptible to the problem. This seemed to largely fix the issue and work continued.  </p><p>Eventually all the minor kinks were sorted out, extra duct tape was added to various parts of the hull, and pc scripts for visualising live data were made (details of which can be seen in <a href="https://fletcherpwalmsley.github.io/about-me-2/">this </a>post)</p><p> </p><p> </p></div><footer class="wrapper post__footer"><p class="post__last-updated">This article was updated on 2 June 2021</p><div class="post__share"></div></footer></article><nav class="post__nav"><div class="post__nav-inner"><div class="post__nav-prev"><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://fletcherpwalmsley.github.io/assets/svg/svg-map.svg#arrow-prev"/></svg> <a href="https://fletcherpwalmsley.github.io/hmnzs-otorohanga/" class="invert post__nav-link" rel="prev"><span>Previous</span> The HMNZS Otorohanga - Beginning </a></div></div></nav></main><footer class="footer"><div class="footer__copyright"><p>Hosted with <a href="https://pages.github.com/">GitHub Pages</a>, built using <a href="https://getpublii.com" target="_blank" rel="nofollow noopener">Publii</a></p></div><button class="footer__bttop js-footer__bttop" aria-label="Back to top"><svg><title>Back to top</title><use xlink:href="https://fletcherpwalmsley.github.io/assets/svg/svg-map.svg#toparrow"/></svg></button></footer></div><script>window.publiiThemeMenuConfig = {    
        mobileMenuMode: 'overlay',
        animationSpeed: 300,
        submenuWidth: 'auto',
        doubleClickTime: 500,
        mobileMenuExpandableSubmenus: true, 
        relatedContainerForOverlayMenuSelector: '.top',
   };</script><script defer="defer" src="https://fletcherpwalmsley.github.io/assets/js/scripts.min.js?v=f4c4d35432d0e17d212f2fae4e0f8247"></script><script>var images = document.querySelectorAll('img[loading]');

        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script><script defer="defer" src="https://fletcherpwalmsley.github.io/assets/js/photoswipe.min.js?v=b586a3bc288c989ecce7b81b48e35855"></script><script defer="defer" src="https://fletcherpwalmsley.github.io/assets/js/photoswipe-ui-default.min.js?v=9952f77ca2b8fbc9449a268008ea8dee"></script><script>var initPhotoSwipeFromDOM=function(gallerySelector){var parseThumbnailElements=function(el){var thumbElements=el.childNodes,numNodes=thumbElements.length,items=[],figureEl,linkEl,size,item;for(var i=0;i<numNodes;i++){figureEl=thumbElements[i];if(figureEl.nodeType!==1){continue;}
          linkEl=figureEl.children[0];size=linkEl.getAttribute('data-size').split('x');item={src:linkEl.getAttribute('href'),w:parseInt(size[0],10),h:parseInt(size[1],10)};if(figureEl.children.length>1){item.title=figureEl.children[1].innerHTML;}
          if(linkEl.children.length>0){item.msrc=linkEl.children[0].getAttribute('src');}
          item.el=figureEl;items.push(item);}
          return items;};var closest=function closest(el,fn){return el&&(fn(el)?el:closest(el.parentNode,fn));};var onThumbnailsClick=function(e){e=e||window.event;e.preventDefault?e.preventDefault():e.returnValue=false;var eTarget=e.target||e.srcElement;var clickedListItem=closest(eTarget,function(el){return(el.tagName&&el.tagName.toUpperCase()==='FIGURE');});if(!clickedListItem){return;}
          var clickedGallery=clickedListItem.parentNode,childNodes=clickedListItem.parentNode.childNodes,numChildNodes=childNodes.length,nodeIndex=0,index;for(var i=0;i<numChildNodes;i++){if(childNodes[i].nodeType!==1){continue;}
          if(childNodes[i]===clickedListItem){index=nodeIndex;break;}
          nodeIndex++;}
          if(index>=0){openPhotoSwipe(index,clickedGallery);}
          return false;};var photoswipeParseHash=function(){var hash=window.location.hash.substring(1),params={};if(hash.length<5){return params;}
          var vars=hash.split('&');for(var i=0;i<vars.length;i++){if(!vars[i]){continue;}
          var pair=vars[i].split('=');if(pair.length<2){continue;}
          params[pair[0]]=pair[1];}
          if(params.gid){params.gid=parseInt(params.gid,10);}
          return params;};var openPhotoSwipe=function(index,galleryElement,disableAnimation,fromURL){var pswpElement=document.querySelectorAll('.pswp')[0],gallery,options,items;items=parseThumbnailElements(galleryElement);options={galleryUID:galleryElement.getAttribute('data-pswp-uid'),getThumbBoundsFn:function(index){var thumbnail=items[index].el.getElementsByTagName('img')[0],pageYScroll=window.pageYOffset||document.documentElement.scrollTop,rect=thumbnail.getBoundingClientRect();return{x:rect.left,y:rect.top+pageYScroll,w:rect.width};},
          mainClass:'pswp--dark',
          preload: [1,2],
          hideAnimationDuration:200,
          showAnimationDuration:0,
          bgOpacity: 0.7,
          showHideOpacity:true,
          closeOnScroll: true,
          arrowKeys: true,
          closeEl: true,
          captionEl: true,
          fullscreenEl: true,
          zoomEl: true,
          shareEl: true,
          counterEl: true,
          arrowEl: true,
          preloaderEl: true
          };if(fromURL){if(options.galleryPIDs){for(var j=0;j<items.length;j++){if(items[j].pid==index){options.index=j;break;}}}else{options.index=parseInt(index,10)-1;}}else{options.index=parseInt(index,10);}
          if(isNaN(options.index)){return;}
          if(disableAnimation){options.showAnimationDuration=0;}
          gallery=new PhotoSwipe(pswpElement,PhotoSwipeUI_Default,items,options);gallery.init();gallery.options.escKey=true;};var galleryElements=document.querySelectorAll(gallerySelector);for(var i=0,l=galleryElements.length;i<l;i++){galleryElements[i].setAttribute('data-pswp-uid',i+1);galleryElements[i].onclick=onThumbnailsClick;}
          var hashData=photoswipeParseHash();if(hashData.pid&&hashData.gid){openPhotoSwipe(hashData.pid,galleryElements[hashData.gid-1],true,true);}};initPhotoSwipeFromDOM('.gallery');</script><div class="pswp" tabindex="-1" role="dialog" aria-hidden="true"><div class="pswp__bg"></div><div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div><div class="pswp__item"></div><div class="pswp__item"></div></div><div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button><button class="pswp__button pswp__button--share" title="Share"></button><button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button><button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button><button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div></body></html>